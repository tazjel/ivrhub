{% extends "layout.html" %}

{% block head %}
{% endblock %}

{% block body %}
<div class='row'>
    <div class='offset3 span6'>
        <form class='form-horizontal' action="{{ url_for('directory', internal_id=user._id) }}" method=post id='profile_edit_form'>
            <fieldset>
                <legend>Editing {{ user.name }}</legend>
                <div class='control-group'>
                    <label class='control-label' for='name'>Name</label>
                    <div class='controls'>
                        <input type='text' class='span3' name='name' id='name' value='{{ user.name }}'>
                    </div>
                </div>
                <div class='control-group'>
                    <label class='control-label' for='email'>Email</label>
                    <div class='controls'>
                        <input type='text' class='span3' name='email' id='email' value='{{ user.email }}'>
                    </div>
                </div>
                <div class='control-group'>
                    <label class='control-label' for='organization'>Organization</label>
                    <div class='controls'>
                        <input type='text' class='span3' name='organization' id='organization' value='{{ user.organization }}'>
                    </div>
                </div>
                <div class='control-group'>
                    <label class='control-label' for='verification'>Verification status</label>
                    <div class='controls'>
                        <label class='radio'>
                            <input type='radio' name='verification' value='verified' 
                            {% if user.verified %}
                            checked
                            {% endif %}
                            > verified - has access to the site
                        </label>
                        <label class='radio'>
                            <input type='radio' name='verification' value='unverified'
                            {% if not user.verified %}
                            checked
                            {% endif %}
                            > not verified - can you confirm this person's identity?
                        </label>
                    </div>
                </div>
                <div class='control-group'>
                    <label class='control-label' for='admin'>Admin status</label>
                    <div class='controls'>
                        <label class='radio'>
                            <input type='radio' name='admin' value='admin' 
                            {% if user.admin_rights %}
                            checked
                            {% endif %}
                            > Admin - can do everything you're doing right now
                        </label>
                        <label class='radio'>
                            <input type='radio' name='admin' value='normal'
                            {% if not user.admin_rights %}
                            checked
                            {% endif %}
                            > not an Admin
                        </label>
                    </div>
                </div>
                <input name=_csrf_token type=hidden value="{{ csrf_token() }}">
                {#
                <div class='control-group'>
                    <label class='control-label' for='delete'>Delete user</label>
                    <div class='controls'>
                #}
                <div class='form-actions'>
                    <button type='submit' class='btn btn-primary'>Save Changes</button>
                </div>
            </fieldset>
        </form>
    </div>
</div>

{% endblock %}

{% block js %}
<script src="{{ url_for('static', filename='js/happy.js') }}"></script>
<script src="{{ url_for('static', filename='js/happy.methods.js') }}"></script>
<script>
    $(function() {
        // initial focus on first input
        $('#name').focus();

        $('#profile_edit_form').isHappy({
            fields: {
                '#name': {
                    required: true
                    , message: ''
                }
                , '#email': {
                    required: true
                    , message: ''
                    , test: happy.email
                }
                , '#organization': {
                    required: true
                    , message: ''
                }
            }
        });

    });
</script>
{% endblock %}
